# 🐳 CultureMap 배포 준비 상태 정리

> **작업 완료일**: 2025년 12월 13일  
> **상태**: ✅ 로컬 환경 배포 준비 완료 (실제 인터넷 배포는 미완료)

---

## 📋 목차

1. [배포 준비 완료 항목](#1-배포-준비-완료-항목)
2. [설정된 구성 요소](#2-설정된-구성-요소)
3. [환경 변수 설정](#3-환경-변수-설정)
4. [해결한 문제들](#4-해결한-문제들)
5. [현재 접속 정보](#5-현재-접속-정보)
6. [실행 방법](#6-실행-방법)
7. [배포 준비 vs 실제 배포](#7-배포-준비-vs-실제-배포)

---

## 1. 배포 준비 완료 항목

### ✅ 완료된 작업

- [x] **Docker Compose 설정 완료**
  - MySQL, Backend, Frontend 3개의 서비스를 하나의 파일로 관리
  - 서비스 간 네트워크 구성 완료
  - 볼륨 설정으로 데이터 영속성 확보

- [x] **백엔드 Docker 이미지 구성**
  - Spring Boot 애플리케이션을 JAR로 빌드
  - Java 17 런타임 환경 설정
  - 프로덕션 프로파일 적용

- [x] **프론트엔드 Docker 이미지 구성**
  - React 애플리케이션 빌드
  - Nginx로 정적 파일 서빙
  - 환경 변수를 빌드 타임에 주입

- [x] **데이터베이스 설정**
  - MySQL 8.0 컨테이너 구성
  - 초기화 SQL 스크립트 적용
  - 데이터 영속성을 위한 볼륨 마운트

- [x] **환경 변수 관리**
  - `.env` 파일을 통한 민감 정보 관리
  - Docker Compose에서 환경 변수 주입

- [x] **외부 API 연동 설정**
  - 카카오 맵 JavaScript API 키 설정
  - 카카오 REST API 키 설정
  - 카카오 개발자 콘솔 도메인 등록

- [x] **CORS 설정**
  - 프론트엔드 도메인 허용 설정
  - 백엔드 SecurityConfig CORS 구성

- [x] **기능 테스트 완료**
  - 회원가입/로그인 기능 정상 작동 확인
  - 플래너 기능 정상 작동 확인
  - 카카오 맵 표시 정상 작동 확인

---

## 2. 설정된 구성 요소

### 2.1 Docker Compose 서비스

| 서비스 | 이미지/빌드 | 포트 | 설명 |
|--------|------------|------|------|
| **mysql** | `mysql:8.0` | `3306:3306` | 데이터베이스 서버 |
| **backend** | 빌드 (Spring Boot) | `8080:8080` | REST API 서버 |
| **frontend** | 빌드 (React + Nginx) | `5173:80` | 웹 애플리케이션 서버 |

### 2.2 네트워크 구성

- **네트워크 이름**: `culturemap-network`
- **타입**: Bridge 네트워크
- **서비스 간 통신**: 서비스 이름으로 접근 가능 (예: `mysql`, `backend`)

### 2.3 볼륨 구성

- **mysql_data**: MySQL 데이터 영속 저장소
- **history_image**: 백엔드 이미지 파일 저장소 (호스트 마운트)

---

## 3. 환경 변수 설정

### 3.1 `.env` 파일 구조

프로젝트 루트에 `.env` 파일을 생성하여 다음 환경 변수들을 설정:

```env
# 데이터베이스 설정
DB_USERNAME=culturemap
DB_PASSWORD=your-password

# JWT 시크릿 키
JWT_SECRET=your-jwt-secret-key

# Kakao API 키
KAKAO_REST_API_KEY=your-kakao-rest-api-key
KAKAO_JAVASCRIPT_KEY=your-kakao-javascript-key

# CORS 설정
CORS_ALLOWED_ORIGINS=http://localhost:5173

# 프론트엔드 API URL
VITE_API_BASE_URL=http://localhost:8080/api
```

### 3.2 환경 변수 사용 위치

#### 백엔드
- `DB_USERNAME`, `DB_PASSWORD`: MySQL 연결 정보
- `JWT_SECRET`: JWT 토큰 서명 키
- `KAKAO_REST_API_KEY`: 카카오 REST API 호출용
- `CORS_ALLOWED_ORIGINS`: 허용할 프론트엔드 도메인

#### 프론트엔드 (빌드 타임)
- `VITE_API_BASE_URL`: 백엔드 API 기본 URL
- `VITE_KAKAO_MAP_API_KEY`: 카카오 맵 JavaScript SDK 키

---

## 4. 해결한 문제들

### 4.1 카카오 맵 SDK 로드 실패
**문제**: REST API 키를 JavaScript SDK에 사용하여 지도 로드 실패  
**해결**: 카카오 개발자 콘솔에서 JavaScript 키 발급 후 `.env`에 `KAKAO_JAVASCRIPT_KEY` 추가

### 4.2 데이터베이스 연결 오류
**문제**: MySQL 인증 실패 (`Access denied for user 'culturemap'`)  
**해결**: Docker 볼륨 초기화 후 새로운 사용자 정보로 재생성

### 4.3 CORS 정책 오류
**문제**: 프론트엔드(`localhost:5173`)에서 백엔드(`localhost:8080`)로의 요청 차단  
**해결**: 
- `.env` 파일에 `CORS_ALLOWED_ORIGINS=http://localhost:5173` 설정
- `docker-compose.yml`에 환경 변수 전달
- 백엔드 재시작으로 설정 적용

### 4.4 프론트엔드 포트 설정
**문제**: 카카오 개발자 콘솔에 `localhost:80`만 등록 가능 (포트 번호 불가)  
**해결**: 프론트엔드 포트를 5173으로 변경하여 카카오 도메인 설정과 일치

---

## 5. 현재 접속 정보

### 로컬 개발 환경

- **프론트엔드**: http://localhost:5173
- **백엔드 API**: http://localhost:8080
- **API 문서 (Swagger)**: http://localhost:8080/swagger-ui.html
- **MySQL**: localhost:3306

### 접속 범위

⚠️ **현재 상태**: 같은 컴퓨터에서만 접속 가능
- 다른 사람의 컴퓨터에서 접속 불가
- 인터넷을 통한 외부 접속 불가
- 실제 배포(공개)는 아직 완료되지 않음

---

## 6. 실행 방법

### 6.1 전체 서비스 시작

```bash
# 프로젝트 루트 디렉토리에서
docker-compose -f docker/docker-compose.yml up -d --build
```

### 6.2 서비스 중지

```bash
# 서비스 중지 (컨테이너 유지)
docker-compose -f docker/docker-compose.yml stop

# 서비스 중지 및 컨테이너 제거 (볼륨 유지)
docker-compose -f docker/docker-compose.yml down

# 모든 것 제거 (볼륨 포함 - 데이터 삭제!)
docker-compose -f docker/docker-compose.yml down -v
```

### 6.3 로그 확인

```bash
# 모든 서비스 로그
docker-compose -f docker/docker-compose.yml logs -f

# 특정 서비스 로그
docker-compose -f docker/docker-compose.yml logs -f backend
docker-compose -f docker/docker-compose.yml logs -f frontend
docker-compose -f docker/docker-compose.yml logs -f mysql
```

### 6.4 컨테이너 상태 확인

```bash
docker-compose -f docker/docker-compose.yml ps
```

---

## 7. 배포 준비 vs 실제 배포

### ✅ 현재 완료된 것 (배포 준비)

1. **Docker 컨테이너화 완료**
   - 모든 서비스가 Docker 이미지로 패키징됨
   - 한 번의 명령어로 전체 시스템 실행 가능

2. **환경 일관성 확보**
   - 개발 환경과 동일한 환경으로 실행 가능
   - 환경 변수로 설정 관리

3. **서비스 간 통신 설정**
   - 네트워크 구성 완료
   - CORS 설정 완료

4. **기능 테스트 완료**
   - 회원가입, 로그인, 플래너 등 핵심 기능 동작 확인

### ❌ 아직 안 된 것 (실제 배포)

1. **서버 필요**
   - AWS EC2, Azure, GCP 등 클라우드 서버 미구축
   - 항상 켜져 있는 공개 서버 없음

2. **도메인/IP 필요**
   - 도메인 이름 미구매 (`www.yoursite.com`)
   - 공개 IP 주소로 접속 불가

3. **포트 노출 필요**
   - 서버의 방화벽에서 80, 8080 포트 미개방
   - 외부에서 접근 불가

4. **프로덕션 환경 설정**
   - 실제 도메인에 맞는 CORS 설정 변경 필요
   - HTTPS 인증서 설정 필요 (보안)
   - 환경 변수를 실제 프로덕션 값으로 변경 필요

---

## 📊 배포 준비 상태 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| Docker 이미지 구성 | ✅ 완료 | Backend, Frontend 모두 구성 완료 |
| Docker Compose 설정 | ✅ 완료 | 3개 서비스 통합 관리 |
| 환경 변수 관리 | ✅ 완료 | `.env` 파일로 관리 |
| 데이터베이스 설정 | ✅ 완료 | MySQL 볼륨 설정 완료 |
| 외부 API 연동 | ✅ 완료 | 카카오 맵 API 설정 완료 |
| CORS 설정 | ✅ 완료 | 프론트엔드-백엔드 통신 가능 |
| 로컬 테스트 | ✅ 완료 | 모든 기능 정상 작동 |
| **실제 서버 배포** | ❌ 미완료 | 클라우드 서버 필요 |
| **도메인 설정** | ❌ 미완료 | 공개 접속 불가 |
| **HTTPS 설정** | ❌ 미완료 | 보안 인증서 필요 |

---

## 🎯 다음 단계 (실제 배포 시)

실제로 인터넷에 배포하려면:

1. **클라우드 서버 구매/대여**
   - AWS EC2, 네이버 클라우드 플랫폼, 카카오 i 클라우드 등

2. **서버에 Docker 설치**
   ```bash
   # 서버 접속 후
   curl -fsSL https://get.docker.com -o get-docker.sh
   sh get-docker.sh
   ```

3. **프로젝트 코드 업로드**
   - Git을 통한 배포 또는 파일 전송

4. **환경 변수 수정**
   - 실제 도메인에 맞게 CORS 설정 변경
   - 프로덕션용 API 키로 변경

5. **도메인 연결**
   - 도메인 구매 후 DNS 설정
   - 또는 공개 IP로 접속

6. **HTTPS 설정 (선택)**
   - Let's Encrypt 인증서 발급
   - Nginx 리버스 프록시 설정

---

## 📝 참고 파일

- `docker/docker-compose.yml`: 전체 서비스 오케스트레이션 설정
- `docker/Dockerfile`: 백엔드 이미지 빌드 설정
- `frontend/Dockerfile`: 프론트엔드 이미지 빌드 설정
- `.env`: 환경 변수 설정 (Git에 커밋되지 않음)
- `database/init.sql`: MySQL 초기화 스크립트

---

**작성일**: 2025년 12월 13일  
**프로젝트**: CultureMap (컬처맵)  
**상태**: ✅ 배포 준비 완료 (로컬 환경)
